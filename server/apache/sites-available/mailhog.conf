<VirtualHost *:80>
    # Name for your virtualhost
    ServerName mailcatcher.example.org

    # Proxy config
    ProxyPreserveHost On
    ProxyRequests Off

    # Websocket proxy needs to be defined first
    ProxyPass "/api/v2/websocket" ws://localhost:8025/api/v2/websocket
    ProxyPassReverse "/api/v2/websocket" ws://localhost:8025/api/v2/websocket

    # General proxy
    ProxyPass / http://localhost:8025/
    ProxyPassReverse / http://localhost:8025/
    RewriteEngine on
    RewriteCond %{SERVER_NAME} =mailcatcher.example.org
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]
</VirtualHost>

<IfModule mod_ssl.c>
<VirtualHost *:443>
    # Name for your virtualhost
    ServerName mailcatcher.example.org

    # Proxy config
    ProxyPreserveHost On
    ProxyRequests Off

    # Websocket proxy needs to be defined first
    ProxyPass "/api/v2/websocket" ws://localhost:8025/api/v2/websocket
    ProxyPassReverse "/api/v2/websocket" ws://localhost:8025/api/v2/websocket

    # General proxy
    ProxyPass / http://localhost:8025/
    ProxyPassReverse / http://localhost:8025/

    SSLEngineOn
    # It is necessary for the snakeoil files ot be present in the initial setup
    # or SSL won't work at all. Let's Encrypt won't work without.
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key
</VirtualHost>
</IfModule>
