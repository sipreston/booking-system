<VirtualHost *:443>

    DocumentRoot "/var/www/booking-system/application/public"
    ServerName booking-system.in
    ServerAlias www.booking-system.in

    <Directory />
        Options +FollowSymLinks
    </Directory>

    <Directory "/var/www/booking-system/application/public/">
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order deny,allow
        Allow from all
    </Directory>

    <FilesMatch “\.(cgi|shtml|phtml|php)$“>
        SSLOptions +StdEnvVars
    </FilesMatch>

    <Directory /usr/lib/cgi-bin>
        SSLOptions +StdEnvVars
    </Directory>

    LogLevel info
    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
    CustomLog "${APACHE_LOG_DIR}/booking-system.access.log" combined
    ErrorLog "${APACHE_LOG_DIR}/booking-system.error.log"

    AllowEncodedSlashes On

    SSLEngine On
    # It is necessary for the snakeoil files ot be present in the initial setup
    # or SSL won't work at all. Let's Encrypt won't work without.
    SSLCertificateFile /etc/ssl/certs/ssl-cert-snakeoil.pem
    SSLCertificateKeyFile /etc/ssl/private/ssl-cert-snakeoil.key

    <FilesMatch \.php$>
      # For Apache version 2.4.10 and above, use SetHandler to run PHP as a fastCGI process server
      SetHandler "proxy:unix:/run/php/php8.4-fpm.sock|fcgi://localhost"
    </FilesMatch>
</VirtualHost>

<VirtualHost *:80>

    DocumentRoot "/var/www/booking-system/application/public"
    ServerName booking-system.in
    ServerAlias www.booking-system.in

    <Directory />
        Options +FollowSymLinks
    </Directory>

    <Directory "/var/www/booking-system/application/public/">
        Options Indexes FollowSymLinks MultiViews
        AllowOverride All
        Order deny,allow
        Allow from all
    </Directory>

    RewriteEngine On
    RewriteCond %{SERVER_PORT} 80
    RewriteRule ^/(.*)$ https://%{HTTP_HOST}/$1 [R=301,L]
    RewriteCond %{SERVER_NAME} =booking-system.in
    RewriteRule ^ https://%{SERVER_NAME}%{REQUEST_URI} [END,NE,R=permanent]

    LogFormat "%h %l %u %t \"%r\" %>s %b \"%{Referer}i\" \"%{User-agent}i\"" combined
    CustomLog "${APACHE_LOG_DIR}/booking-system.log" combined
    ErrorLog "${APACHE_LOG_DIR}/booking-system.error.log"

    php_admin_value error_log ${APACHE_LOG_DIR}/booking-system_php_errors.log

    LogLevel info

    AllowEncodedSlashes On

    <IfModule mod_headers.c>
        Header unset X-Runtime
        Header unset X-Powered-By
    </IfModule>

    <FilesMatch \.php$>
      # For Apache version 2.4.10 and above, use SetHandler to run PHP as a fastCGI process server
      SetHandler "proxy:unix:/run/php/php8.4-fpm.sock|fcgi://localhost"
    </FilesMatch>
</VirtualHost>
